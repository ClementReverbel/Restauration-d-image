import numpy as np
import matplotlib.pyplot as plt
from datetime import datetime
bruit_types = ['additif', 'multiplicatif', 'sel_poivre']
methods = [
       'median_crop', 'median_extension', 'median_miroir', 'median_wrap',
       'conv_rect_crop','conv_rect_ext','conv_rect_miroir','conv_rect_wrap',
       'conv_circ_crop','conv_circ_ext','conv_circ_miroir','conv_circ_wrap',
       'conv_pyr_crop','conv_pyr_ext','conv_pyr_miroir','conv_pyr_wrap',
       'conv_cone_crop','conv_cone_ext','conv_cone_miroir','conv_cone_wrap'
]
kernel_sizes = [3, 5, 7]     
noise_levels = ['faible', 'moyen', 'élevé']
filtered_snr={'additif': {'median_crop': np.array([[4.01974136, 3.1134423 , 1.70444018],
       [5.97722064, 7.88999329, 8.04293814],
       [4.90742206, 7.59788462, 8.64380077]]), 'median_extension': np.array([[4.11986038, 3.33406021, 1.9591622 ],
       [6.15850762, 8.67813134, 9.36080745],
       [5.00069553, 8.16262151, 9.93615317]]), 'median_miroir': np.array([[4.11986038, 3.31160089, 1.93870599],
       [6.15850762, 8.68906191, 9.38362273],
       [5.00069553, 8.17347521, 9.98086295]]), 'median_wrap': np.array([[ 4.04153803,  3.23610256,  1.85165376],
       [ 6.17573964,  8.68077162,  9.3312114 ],
       [ 5.02218607,  8.21073241, 10.0184786 ]]), 'conv_rect_crop': np.array([[4.35744631, 2.40810464, 0.87228304],
       [6.31447714, 6.84576333, 6.42453327],
       [4.46707852, 5.03195526, 4.97104391]]), 'conv_rect_ext': np.array([[4.49123059, 2.60403058, 1.05861456],
       [6.5861805 , 7.57981866, 7.40965284],
       [4.61926436, 5.47293935, 5.65603382]]), 'conv_rect_miroir': np.array([[4.49123059, 2.58875562, 1.04751203],
       [6.5861805 , 7.58404621, 7.42290941],
       [4.61926436, 5.47439213, 5.65890128]]), 'conv_rect_wrap': np.array([[4.30352376, 2.42005562, 0.87420901],
       [6.58065923, 7.5461627 , 7.35078417],
       [4.62518808, 5.47027055, 5.64511202]]), 'conv_circ_crop': np.array([[4.84370268, 4.11479406, 2.23231727],
       [5.12857488, 6.56054103, 6.62122993],
       [3.60201996, 4.65493331, 4.89111061]]), 'conv_circ_ext': np.array([[4.98924601, 4.42106142, 2.51428531],
       [5.30730102, 7.20634911, 7.65208003],
       [3.70602524, 5.03211094, 5.54733164]]), 'conv_circ_miroir': np.array([[4.84370268, 4.11479406, 2.23231727],
       [5.12857488, 6.56054103, 6.62122993],
       [3.60201996, 4.65493331, 4.89111061]]), 'conv_circ_wrap': np.array([[4.91831058, 4.26277701, 2.3401359 ],
       [5.31698639, 7.20116286, 7.61900413],
       [3.71355579, 5.03721566, 5.544085  ]]), 'conv_pyr_crop': np.array([[5.20766009, 3.9566367 , 2.54538082],
       [5.96323777, 6.91656472, 6.77148814],
       [4.16922971, 4.90760214, 4.95983475]]), 'conv_pyr_ext': np.array([[5.37183128, 4.25307373, 2.86290357],
       [6.19713967, 7.64314524, 7.85451599],
       [4.30079502, 5.32353924, 5.63438146]]), 'conv_pyr_miroir': np.array([[5.20766009, 3.9566367 , 2.54538082],
       [5.96323777, 6.91656472, 6.77148814],
       [4.16922971, 4.90760214, 4.95983475]]), 'conv_pyr_wrap': np.array([[5.25018997, 4.07634173, 2.6796339 ],
       [6.2083941 , 7.63382473, 7.82309244],
       [4.31164469, 5.32882461, 5.63250458]]), 'conv_cone_crop': np.array([[4.99011247, 4.66250963, 3.19749363],
       [4.88140141, 6.36854696, 6.69721818],
       [3.42035431, 4.48109673, 4.82308427]]), 'conv_cone_ext': np.array([[5.13211267, 5.00428962, 3.57284613],
       [5.03638803, 6.96427297, 7.74209006],
       [3.51156349, 4.82981138, 5.45771489]]), 'conv_cone_miroir': np.array([[4.99011247, 4.66250963, 3.19749363],
       [4.88140141, 6.36854696, 6.69721818],
       [3.42035431, 4.48109673, 4.82308427]]), 'conv_cone_wrap': np.array([[5.09230254, 4.84138372, 3.38950849],
       [5.05554052, 6.96666589, 7.72194701],
       [3.52390448, 4.83842177, 5.45956692]])}, 'multiplicatif': {'median_crop': np.array([[5.23037597, 5.83591337, 5.06309555],
       [5.53720259, 8.09473484, 8.75603608],
       [2.6129699 , 5.17484658, 6.83308335]]), 'median_extension': np.array([[ 5.39707176,  6.30769246,  5.70295087],
       [ 5.65838238,  8.80996025, 10.17827579],
       [ 2.64571794,  5.39599359,  7.46023229]]), 'median_miroir': np.array([[ 5.39707176,  6.30676182,  5.70633681],
       [ 5.65838238,  8.82090463, 10.22061798],
       [ 2.64571794,  5.41642302,  7.53907541]]), 'median_wrap': np.array([[ 5.37908208,  6.2512463 ,  5.60076143],
       [ 5.69379541,  8.86031516, 10.22325883],
       [ 2.65752108,  5.45695236,  7.60142728]]), 'conv_rect_crop': np.array([[6.06214157, 5.38764992, 4.24331122],
       [4.4323049 , 4.88735602, 4.77012415],
       [2.94953628, 3.32139842, 3.28898748]]), 'conv_rect_ext': np.array([[6.31323115, 5.86457412, 4.79080323],
       [4.5926823 , 5.33658733, 5.42569678],
       [3.05180964, 3.59031887, 3.70367135]]), 'conv_rect_miroir': np.array([[6.31323115, 5.85837442, 4.78839254],
       [4.5926823 , 5.34049878, 5.43616866],
       [3.05180964, 3.59536565, 3.71379879]]), 'conv_rect_wrap': np.array([[6.23536944, 5.74413962, 4.6515011 ],
       [4.60010621, 5.3398379 , 5.42579983],
       [3.05663298, 3.59631866, 3.7119118 ]]), 'conv_circ_crop': np.array([[5.39373864, 6.10162268, 5.14307411],
       [3.61119007, 4.59642642, 4.75398095],
       [2.40713516, 3.07461221, 3.23223077]]), 'conv_circ_ext': np.array([[5.5863884 , 6.65704757, 5.84275857],
       [3.72166314, 4.98398597, 5.39595532],
       [2.47879955, 3.30717368, 3.63158965]]), 'conv_circ_miroir': np.array([[5.39373864, 6.10162268, 5.14307411],
       [3.61119007, 4.59642642, 4.75398095],
       [2.40713516, 3.07461221, 3.23223077]]), 'conv_circ_wrap': np.array([[5.57303313, 6.58366409, 5.72617767],
       [3.73018479, 4.99147336, 5.39931667],
       [2.48533964, 3.3136524 , 3.63870817]]), 'conv_pyr_crop': np.array([[6.14109492, 6.24970698, 5.39300735],
       [4.15579437, 4.82371669, 4.82723722],
       [2.75288261, 3.23470995, 3.27194544]]), 'conv_pyr_ext': np.array([[6.38471446, 6.83796535, 6.15038895],
       [4.29436971, 5.24944584, 5.48794953],
       [2.84100445, 3.48823828, 3.68049438]]), 'conv_pyr_miroir': np.array([[6.14109492, 6.24970698, 5.39300735],
       [4.15579437, 4.82371669, 4.82723722],
       [2.75288261, 3.23470995, 3.27194544]]), 'conv_pyr_wrap': np.array([[6.35385006, 6.74759953, 6.03104186],
       [4.30600307, 5.25805168, 5.49262552],
       [2.84932802, 3.49589249, 3.68824055]]), 'conv_cone_crop': np.array([[5.24535076, 6.22041438, 5.70481784],
       [3.42943938, 4.44038736, 4.72627955],
       [2.2817334 , 2.96053469, 3.18506443]]), 'conv_cone_ext': np.array([[5.417442  , 6.77609734, 6.51864362],
       [3.52624103, 4.79840519, 5.35571267],
       [2.34434259, 3.17680357, 3.57341036]]), 'conv_cone_miroir': np.array([[5.24535076, 6.22041438, 5.70481784],
       [3.42943938, 4.44038736, 4.72627955],
       [2.2817334 , 2.96053469, 3.18506443]]), 'conv_cone_wrap': np.array([[5.42212169, 6.71393684, 6.41147397],
       [3.53909482, 4.8088568 , 5.36211085],
       [2.35364704, 3.18411053, 3.58020258]])}, 'sel_poivre': {'median_crop': np.array([[10.08171627,  7.18183756,  5.27456187],
       [13.5288199 , 11.4701551 ,  9.87723583],
       [ 9.82771139, 12.91173764, 11.38965106]]), 'median_extension': np.array([[10.74099012,  7.8756437 ,  5.92561651],
       [14.96959397, 13.69703967, 12.05712222],
       [10.29725623, 15.9100792 , 14.97181357]]), 'median_miroir': np.array([[10.74099012,  7.81018668,  5.88711598],
       [14.96959397, 13.6416168 , 12.02077138],
       [10.29725623, 15.98997026, 14.95995709]]), 'median_wrap': np.array([[10.57387198,  7.77673043,  5.852051  ],
       [14.81664824, 13.52860238, 11.94176022],
       [10.37914649, 15.84737612, 14.82004998]]), 'conv_rect_crop': np.array([[6.10953177, 5.13765451, 3.89373427],
       [6.70292123, 7.25752746, 6.83590357],
       [5.45689018, 6.2123413 , 6.03924061]]), 'conv_rect_ext': np.array([[6.31790355, 5.5232164 , 4.30175499],
       [6.94042844, 7.9745656 , 7.77939393],
       [5.6594305 , 6.73539509, 6.87231695]]), 'conv_rect_miroir': np.array([[6.31790355, 5.51480082, 4.29796532],
       [6.94042844, 7.97613414, 7.78457976],
       [5.6594305 , 6.7439696 , 6.88762802]]), 'conv_rect_wrap': np.array([[6.21088494, 5.37919248, 4.13979723],
       [6.91873296, 7.91800324, 7.69966373],
       [5.66241691, 6.73037943, 6.85892132]]), 'conv_circ_crop': np.array([[5.57380463, 6.11591368, 4.94787348],
       [5.40056636, 6.97827495, 7.07299908],
       [4.35959622, 5.75980719, 6.00637318]]), 'conv_circ_ext': np.array([[5.74093101, 6.59873256, 5.4942526 ],
       [5.55256225, 7.6191223 , 8.07375554],
       [4.49136379, 6.19990496, 6.82070609]]), 'conv_circ_miroir': np.array([[5.57380463, 6.11591368, 4.94787348],
       [5.40056636, 6.97827495, 7.07299908],
       [4.35959622, 5.75980719, 6.00637318]]), 'conv_circ_wrap': np.array([[5.71471275, 6.50306625, 5.35664603],
       [5.55220813, 7.59710477, 8.0176868 ],
       [4.49817616, 6.20460149, 6.81565524]]), 'conv_pyr_crop': np.array([[6.3252974 , 6.21544296, 5.23067166],
       [6.32127753, 7.37255817, 7.25418651],
       [5.08000953, 6.09364348, 6.10764374]]), 'conv_pyr_ext': np.array([[6.53657679, 6.71841977, 5.82979407],
       [6.5248695 , 8.09703168, 8.31581721],
       [5.2506318 , 6.58845867, 6.95230822]]), 'conv_pyr_miroir': np.array([[6.3252974 , 6.21544296, 5.23067166],
       [6.32127753, 7.37255817, 7.25418651],
       [5.08000953, 6.09364348, 6.10764374]]), 'conv_pyr_wrap': np.array([[6.48433247, 6.60134389, 5.68611872],
       [6.52249937, 8.06654837, 8.26043392],
       [5.2616444 , 6.593022  , 6.94872655]]), 'conv_cone_crop': np.array([[5.45400197, 6.33234624, 5.634835  ],
       [5.1295434 , 6.77075969, 7.17010456],
       [4.13083676, 5.53921612, 5.9578087 ]]), 'conv_cone_ext': np.array([[5.60502278, 6.82735019, 6.29521247],
       [5.26106285, 7.36156016, 8.19418141],
       [4.24541987, 5.94087132, 6.75211012]]), 'conv_cone_miroir': np.array([[5.45400197, 6.33234624, 5.634835  ],
       [5.1295434 , 6.77075969, 7.17010456],
       [4.13083676, 5.53921612, 5.9578087 ]]), 'conv_cone_wrap': np.array([[5.59976916, 6.73817469, 6.16250855],
       [5.27024011, 7.34745774, 8.15122172],
       [4.25888107, 5.94892572, 6.75241617]])}}

if __name__=="__main__":
       fig, axs = plt.subplots(nrows=3, ncols=3, figsize=(15, 10), sharex=True)
       cmap = plt.get_cmap('tab20')
       colors = [cmap(i) for i in range(len(methods))]

       for i, b in enumerate(bruit_types):
              for j, lvl in enumerate(noise_levels):
                     ax = axs[i, j]
                     
                     # Tracer chaque méthode
                     for idx, m in enumerate(methods):
                            y = filtered_snr[b][m][j]
                            ax.plot(kernel_sizes, y, label=m,
                                   color=colors[idx], linewidth=1,
                                   marker='o', markersize=2)
                     
                     # Ajuste automatiquement l’échelle
                     ymin, ymax = ax.get_ylim()
                     ax.set_ylim(ymin, ymax)  # force matplotlib à recaler
                     ax.set_title(f"{b} — {lvl}")
                     
                     if j == 0:
                            ax.set_ylabel("Gain de SNR")
                     if i == 2:  # dernière ligne
                            ax.set_xlabel("Taille du noyau")
                     
                     ax.grid(True, linestyle=':', linewidth=0.4, alpha=0.5)

       # Légende globale (simple)
       fig.legend(methods, loc='center right', bbox_to_anchor=(1.02, 0.5))
       fig.tight_layout(rect=[0, 0, 0.88, 1])

       plt.savefig("./graphique/graphique_snr_3x3_"+str(datetime.now().strftime("%Hh%M_%d_%m_%Y"))+".png", dpi=200)
       plt.close(fig)

